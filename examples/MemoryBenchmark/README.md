# Memory Benchmark

The `MemoryBenchmark.ino` was compiled with each `FEATURE_*` and the flash
memory and static RAM sizes were recorded. The `FEATURE_BASELINE` selection is
the baseline, and its memory usage numbers are subtracted from the subsequent
`FEATURE_*` memory usage.

**Version**: AceCommon v1.4.5

**DO NOT EDIT**: This file was auto-generated using `make README.md`.

## How to Regenerate

To regenerate this README.md:

```
$ make clean_benchmarks
$ make benchmarks
$ make README.md
```

The `make benchmarks` target uses `collect.sh` script which calls `auniter.sh`
(https://github.com/bxparks/AUniter) to invoke the Arduino IDE programmatically.
It produces a `*.txt` file with the flash and ram usage information (e.g.
`nano.txt`).

The `make README.md` command calls the `generated_readme.py` Python script which
generates this `README.md` file. The ASCII tables below are generated by the
`generate_table.awk` script, which takes each `*.txt` file and converts it to an
ASCII table.

## Library Size Changes

**v1.4.5**

* Upgrading from ESP32 Core v1.0.4 to v1.0.6 causes `PrintStrN` to be about
  1300 bytes larger than `PrintStr`, probably because the `new` and `delete`
  operators bring in more complex code. But the overall ESP32 flash usage goes
  down by 7.5 kB compared to v1.0.4, so this is probably not something to worry
  about.
* Added benchmarks for `udiv1000()` and native `/1000`. The `udiv1000()`
  function consumes about 180 bytes on 8-bit AVR processors, more than the
  native division by `/1000` which takes about 130 bytes.

**v1.4.5+**

* Upgrade STM32duino Core from 1.9.0 to 2.0.0.
    * Flash memory increases by 2.3kB across the board.
    * Static memory decreases by 250 bytes across the board.
    * AceCommon code unchanged.
* Upgrade SparkFun SAMD Core from 1.8.1 to 1.8.3.
    * No changes to flash or static memory.
* Add benchmark for `String` so to compare with `PrintStr<N>` and `PrintStrN`.
    * Pull in `Serial` into the Baseline to compensate for pulling in the
      `Print` class, the parent class of `PrintStr` and `PrintStrN`.
* Add benchmark for `isSorted()`.
    * Add `array[100]` into Baseline to compensate for its use in `isSorted()`.

## Arduino Nano

* 16MHz ATmega328P
* Arduino IDE 1.8.13
* Arduino AVR Boards 1.8.3

```
+---------------------------------------------------------------------+
| Functionality                          |  flash/  ram |       delta |
|----------------------------------------+--------------+-------------|
| Baseline                               |   2128/  289 |     0/    0 |
|----------------------------------------+--------------+-------------|
| String                                 |   3610/  301 |  1482/   12 |
| PrintStr<16>                           |   2520/  301 |   392/   12 |
| PrintStrN(16)                          |   3136/  311 |  1008/   22 |
|----------------------------------------+--------------+-------------|
| printPad2()                            |   2212/  289 |    84/    0 |
| printPad5()                            |   2230/  289 |   102/    0 |
|----------------------------------------+--------------+-------------|
| printReplaceCharTo(char*)              |   2168/  293 |    40/    4 |
| printReplaceCharTo(F())                |   2164/  289 |    36/    0 |
| printReplaceStringTo(char*)            |   2186/  295 |    58/    6 |
| printReplaceStringTo(F())              |   2182/  291 |    54/    2 |
|----------------------------------------+--------------+-------------|
| hashDjb2(char*)                        |   2194/  289 |    66/    0 |
| hashDjb2(F())                          |   2194/  289 |    66/    0 |
|----------------------------------------+--------------+-------------|
| udiv1000()                             |   2264/  289 |   136/    0 |
| /1000                                  |   2198/  289 |    70/    0 |
|----------------------------------------+--------------+-------------|
| isSorted()                             |   2162/  289 |    34/    0 |
+---------------------------------------------------------------------+

```

## Sparkfun Pro Micro

* 16 MHz ATmega32U4
* Arduino IDE 1.8.13
* SparkFun AVR Boards 1.1.13

```
+---------------------------------------------------------------------+
| Functionality                          |  flash/  ram |       delta |
|----------------------------------------+--------------+-------------|
| Baseline                               |   4250/  254 |     0/    0 |
|----------------------------------------+--------------+-------------|
| String                                 |   5732/  264 |  1482/   10 |
| PrintStr<16>                           |   4648/  266 |   398/   12 |
| PrintStrN(16)                          |   5258/  276 |  1008/   22 |
|----------------------------------------+--------------+-------------|
| printPad2()                            |   4334/  254 |    84/    0 |
| printPad5()                            |   4350/  254 |   100/    0 |
|----------------------------------------+--------------+-------------|
| printReplaceCharTo(char*)              |   4290/  258 |    40/    4 |
| printReplaceCharTo(F())                |   4286/  254 |    36/    0 |
| printReplaceStringTo(char*)            |   4308/  260 |    58/    6 |
| printReplaceStringTo(F())              |   4304/  256 |    54/    2 |
|----------------------------------------+--------------+-------------|
| hashDjb2(char*)                        |   4316/  254 |    66/    0 |
| hashDjb2(F())                          |   4316/  254 |    66/    0 |
|----------------------------------------+--------------+-------------|
| udiv1000()                             |   4386/  254 |   136/    0 |
| /1000                                  |   4320/  254 |    70/    0 |
|----------------------------------------+--------------+-------------|
| isSorted()                             |   4284/  254 |    34/    0 |
+---------------------------------------------------------------------+

```

## SAMD21 M0 Mini

* 48 MHz ARM Cortex-M0+
* Arduino IDE 1.8.13
* Sparkfun SAMD Boards 1.8.3

```
+---------------------------------------------------------------------+
| Functionality                          |  flash/  ram |       delta |
|----------------------------------------+--------------+-------------|
| Baseline                               |  10892/    0 |     0/    0 |
|----------------------------------------+--------------+-------------|
| String                                 |  11628/    0 |   736/    0 |
| PrintStr<16>                           |  11060/    0 |   168/    0 |
| PrintStrN(16)                          |  11260/    0 |   368/    0 |
|----------------------------------------+--------------+-------------|
| printPad2()                            |  10988/    0 |    96/    0 |
| printPad5()                            |  11012/    0 |   120/    0 |
|----------------------------------------+--------------+-------------|
| printReplaceCharTo(char*)              |  10928/    0 |    36/    0 |
| printReplaceCharTo(F())                |  10928/    0 |    36/    0 |
| printReplaceStringTo(char*)            |  10948/    0 |    56/    0 |
| printReplaceStringTo(F())              |  10948/    0 |    56/    0 |
|----------------------------------------+--------------+-------------|
| hashDjb2(char*)                        |  10920/    0 |    28/    0 |
| hashDjb2(F())                          |  10936/    0 |    44/    0 |
|----------------------------------------+--------------+-------------|
| udiv1000()                             |  10932/    0 |    40/    0 |
| /1000                                  |  10924/    0 |    32/    0 |
|----------------------------------------+--------------+-------------|
| isSorted()                             |  10912/    0 |    20/    0 |
+---------------------------------------------------------------------+

```

(SAMD compiler does not produce RAM usage numbers.)

## STM32 Blue Pill

* STM32F103C8, 72 MHz ARM Cortex-M3
* Arduino IDE 1.8.13
* STM32duino 2.0.0

```
+---------------------------------------------------------------------+
| Functionality                          |  flash/  ram |       delta |
|----------------------------------------+--------------+-------------|
| Baseline                               |  27008/ 3744 |     0/    0 |
|----------------------------------------+--------------+-------------|
| String                                 |  27556/ 3744 |   548/    0 |
| PrintStr<16>                           |  27164/ 3744 |   156/    0 |
| PrintStrN(16)                          |  27184/ 3744 |   176/    0 |
|----------------------------------------+--------------+-------------|
| printPad2()                            |  27104/ 3744 |    96/    0 |
| printPad5()                            |  27128/ 3744 |   120/    0 |
|----------------------------------------+--------------+-------------|
| printReplaceCharTo(char*)              |  27040/ 3744 |    32/    0 |
| printReplaceCharTo(F())                |  27040/ 3744 |    32/    0 |
| printReplaceStringTo(char*)            |  27060/ 3744 |    52/    0 |
| printReplaceStringTo(F())              |  27060/ 3744 |    52/    0 |
|----------------------------------------+--------------+-------------|
| hashDjb2(char*)                        |  27032/ 3744 |    24/    0 |
| hashDjb2(F())                          |  27040/ 3744 |    32/    0 |
|----------------------------------------+--------------+-------------|
| udiv1000()                             |  27048/ 3744 |    40/    0 |
| /1000                                  |  27040/ 3744 |    32/    0 |
|----------------------------------------+--------------+-------------|
| isSorted()                             |  27044/ 3744 |    36/    0 |
+---------------------------------------------------------------------+

```

An entry of `-1` indicates that the memory usage exceeded the maximum of the
microcontroller and the compiler did not generate the desired information.

## ESP8266

* NodeMCU 1.0, 80MHz ESP8266
* Arduino IDE 1.8.13
* ESP8266 Boards 2.7.4

```
+---------------------------------------------------------------------+
| Functionality                          |  flash/  ram |       delta |
|----------------------------------------+--------------+-------------|
| Baseline                               | 262256/26992 |     0/    0 |
|----------------------------------------+--------------+-------------|
| String                                 | 262404/26988 |   148/   -4 |
| PrintStr<16>                           | 262480/26992 |   224/    0 |
| PrintStrN(16)                          | 262512/26992 |   256/    0 |
|----------------------------------------+--------------+-------------|
| printPad2()                            | 262416/26992 |   160/    0 |
| printPad5()                            | 262448/26992 |   192/    0 |
|----------------------------------------+--------------+-------------|
| printReplaceCharTo(char*)              | 262292/26988 |    36/   -4 |
| printReplaceCharTo(F())                | 262308/26992 |    52/    0 |
| printReplaceStringTo(char*)            | 262328/26992 |    72/    0 |
| printReplaceStringTo(F())              | 262344/26988 |    88/   -4 |
|----------------------------------------+--------------+-------------|
| hashDjb2(char*)                        | 262288/26992 |    32/    0 |
| hashDjb2(F())                          | 262328/26992 |    72/    0 |
|----------------------------------------+--------------+-------------|
| udiv1000()                             | 262320/26992 |    64/    0 |
| /1000                                  | 262304/26992 |    48/    0 |
|----------------------------------------+--------------+-------------|
| isSorted()                             | 262288/26992 |    32/    0 |
+---------------------------------------------------------------------+

```

## ESP32

* ESP32-01 Dev Board, 240 MHz Tensilica LX6
* Arduino IDE 1.8.13
* ESP32 Boards 1.0.6

```
+---------------------------------------------------------------------+
| Functionality                          |  flash/  ram |       delta |
|----------------------------------------+--------------+-------------|
| Baseline                               | 204790/13536 |     0/    0 |
|----------------------------------------+--------------+-------------|
| String                                 | 205194/13536 |   404/    0 |
| PrintStr<16>                           | 205066/13536 |   276/    0 |
| PrintStrN(16)                          | 206394/13536 |  1604/    0 |
|----------------------------------------+--------------+-------------|
| printPad2()                            | 204862/13536 |    72/    0 |
| printPad5()                            | 204886/13536 |    96/    0 |
|----------------------------------------+--------------+-------------|
| printReplaceCharTo(char*)              | 204834/13536 |    44/    0 |
| printReplaceCharTo(F())                | 204834/13536 |    44/    0 |
| printReplaceStringTo(char*)            | 204874/13536 |    84/    0 |
| printReplaceStringTo(F())              | 204874/13536 |    84/    0 |
|----------------------------------------+--------------+-------------|
| hashDjb2(char*)                        | 204822/13536 |    32/    0 |
| hashDjb2(F())                          | 204846/13536 |    56/    0 |
|----------------------------------------+--------------+-------------|
| udiv1000()                             | 204870/13536 |    80/    0 |
| /1000                                  | 204854/13536 |    64/    0 |
|----------------------------------------+--------------+-------------|
| isSorted()                             | 204826/13536 |    36/    0 |
+---------------------------------------------------------------------+

```

RAM usage remains constant as more objects are created, which indicates that an
initial pool of a certain minimum size is created regardless of the actual RAM
usage by objects.

## Teensy 3.2

* 96 MHz ARM Cortex-M4
* Arduino IDE 1.8.13
* Teensyduino 1.53

```
+---------------------------------------------------------------------+
| Functionality                          |  flash/  ram |       delta |
|----------------------------------------+--------------+-------------|
| Baseline                               |  11972/ 4276 |     0/    0 |
|----------------------------------------+--------------+-------------|
| String                                 |  14576/ 4276 |  2604/    0 |
| PrintStr<16>                           |  12448/ 4276 |   476/    0 |
| PrintStrN(16)                          |  12512/ 4276 |   540/    0 |
|----------------------------------------+--------------+-------------|
| printPad2()                            |  12004/ 4276 |    32/    0 |
| printPad5()                            |  12020/ 4276 |    48/    0 |
|----------------------------------------+--------------+-------------|
| printReplaceCharTo(char*)              |  12004/ 4276 |    32/    0 |
| printReplaceCharTo(F())                |  12004/ 4276 |    32/    0 |
| printReplaceStringTo(char*)            |  12024/ 4276 |    52/    0 |
| printReplaceStringTo(F())              |  12024/ 4276 |    52/    0 |
|----------------------------------------+--------------+-------------|
| hashDjb2(char*)                        |  12000/ 4276 |    28/    0 |
| hashDjb2(F())                          |  12008/ 4276 |    36/    0 |
|----------------------------------------+--------------+-------------|
| udiv1000()                             |  12012/ 4276 |    40/    0 |
| /1000                                  |  12008/ 4276 |    36/    0 |
|----------------------------------------+--------------+-------------|
| isSorted()                             |  11996/ 4276 |    24/    0 |
+---------------------------------------------------------------------+

```

